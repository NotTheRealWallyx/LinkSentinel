name: LinkSentinel
description: Validate links in Markdown and reStructuredText docs

inputs:
  path:
    description: "Directory to scan for links"
    required: false
    default: "."

runs:
  using: "composite"
  steps:
    - uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Install Rust (needed for Rye)
      shell: bash
      run: |
        curl https://sh.rustup.rs -sSf | sh -s -- -y
        echo "$HOME/.cargo/bin" >> $GITHUB_PATH
        echo "export PATH=$HOME/.cargo/bin:$PATH" >> $GITHUB_ENV

    - name: Install Rye from source
      shell: bash
      run: |
        source $HOME/.cargo/env
        cargo install --git https://github.com/mitsuhiko/rye.git rye
        echo "Rye version: $(rye --version)"

    - name: Install dependencies from pyproject.toml
      shell: bash
      run: |
        rye self install
        rye sync --no-venv

    - name: Run link validator
      shell: bash
      run: |
        python ${{ github.action_path }}/linksentinel/link_validator.py ${{ inputs.path }}
